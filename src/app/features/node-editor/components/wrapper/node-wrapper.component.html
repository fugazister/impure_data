<svg:g 
  class="node"
  [class]="'node-type-' + node.type.replace('.', '-')"
  [class.selected]="isSelected"
  [class.editing]="isEditing"
  [class.execution-mode]="!isEditMode"
  [attr.transform]="'translate(' + node.position.x + ',' + node.position.y + ')'"
  (contextmenu)="onNodeRightClick($event)"
>
  <!-- Node background -->
  <svg:rect
    class="node-background"
    [attr.width]="width"
    [attr.height]="height"
    [attr.fill]="backgroundColor"
    rx="4"
    ry="4"
  />
  
  <!-- Custom node content slot -->
  <ng-content></ng-content>
  
  <!-- Move handle indicator -->
  <svg:text
    class="move-indicator"
    [attr.x]="width - 20"
    y="20"
  >
    ⋮⋮
  </svg:text>
  
  <!-- Input ports using SVG UI Kit -->
  @for (input of (node.inputs || []); track input.id; let i = $index) {
    <svg:g svg-port
      [portId]="input.id"
      type="input"
      [position]="{ x: 0, y: getPortY(i) }"
      [label]="input.label"
      [connected]="isPortConnected(input.id, 'input')"
      [showConnectionWarning]="node.type === 'function' && (node.inputs || []).length > 1"
      (onMouseDown)="onPortMouseDown($event.event, $event.portId, $event.portType)"
      (onMouseUp)="onPortMouseUp($event.event, $event.portId, $event.portType)">
    </svg:g>
  }
  
  <!-- Output ports using SVG UI Kit -->
  @for (output of (node.outputs || []); track output.id; let i = $index) {
    <svg:g svg-port
      [portId]="output.id"
      type="output"
      [position]="{ x: width, y: getPortY(i) }"
      [label]="output.label"
      [connected]="isPortConnected(output.id, 'output')"
      (onMouseDown)="onPortMouseDown($event.event, $event.portId, $event.portType)"
      (onMouseUp)="onPortMouseUp($event.event, $event.portId, $event.portType)">
    </svg:g>
  }
</svg:g>